<div class="space-y-8">
    <section class="glass-panel rounded-3xl border border-white/10 p-6 sm:p-8">
        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
            <div class="text-center md:text-left">
                <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Welcome back</p>
                <h1 class="text-3xl font-bold text-white">Operations console</h1>
                <p class="text-slate-300">Monitor competitions, spin up new seasons, and keep teams moving from one spot.</p>
            </div>
            <div class="flex flex-wrap justify-center md:justify-end gap-3">
                <a href="/scoreboard"
                    class="inline-flex items-center rounded-2xl bg-blue-500 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-600">View
                    scoreboard</a>
                {{if .CanManage}}
                <button id="open-create"
                    class="inline-flex items-center rounded-2xl border border-white/30 px-4 py-2 text-sm font-semibold text-white/90 hover:bg-white/10">Create
                    competition</button>
                {{end}}
            </div>
        </div>
    </section>

    <section class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3" id="dashboard-stats">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Total competitions</p>
            <p class="text-3xl font-bold text-white" data-stat="total">0</p>
        </div>
        <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Public</p>
            <p class="text-3xl font-bold text-white" data-stat="public">0</p>
        </div>
        <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Private</p>
            <p class="text-3xl font-bold text-white" data-stat="private">0</p>
        </div>
    </section>

    {{with .ResourceInfo}}
    <section class="rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-7">
        <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
            <div>
                <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Resource restrictions & information</p>
                <h2 class="text-2xl font-semibold text-white">Container guardrails · Network capacity</h2>
                <p class="text-sm text-slate-400">Operators can constrain what container builds get deployed and keep an eye on available /16 networks.</p>
            </div>
            <p class="text-xs text-slate-300">
                Gateway · {{ .Network.Gateway }}<br>
                Nameserver · {{ .Network.Nameserver }} · Search domain · {{ .Network.SearchDomain }}
            </p>
        </div>
        <div class="mt-6 grid gap-4 lg:grid-cols-2">
            <article class="rounded-2xl border border-white/5 bg-white/5 p-5">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Container restrictions</p>
                        <h3 class="text-lg font-semibold text-white">Allowed resources</h3>
                    </div>
                    <p class="text-xs text-slate-400">Drive predictable builds</p>
                </div>
                <div class="mt-4 space-y-3 text-sm">
                    <div>
                        <p class="text-xs text-slate-400">Allowed templates</p>
                        <div class="mt-2 flex flex-wrap gap-2">
                            {{if .Restrictions.AllowedLXCTemplates}}
                                {{range .Restrictions.AllowedLXCTemplates}}
                                <span class="inline-flex items-center rounded-full border border-white/20 bg-slate-900/60 px-3 py-1 text-xs text-slate-200">{{.}}</span>
                                {{end}}
                            {{else}}
                                <span class="inline-flex items-center rounded-full border border-white/20 bg-slate-900/60 px-3 py-1 text-xs text-slate-200">Any template allowed</span>
                            {{end}}
                        </div>
                    </div>
                    <div>
                        <p class="text-xs text-slate-400">Allowed storage pools</p>
                        <div class="mt-2 flex flex-wrap gap-2">
                            {{if .Restrictions.AllowedStoragePools}}
                                {{range .Restrictions.AllowedStoragePools}}
                                <span class="inline-flex items-center rounded-full border border-white/20 bg-slate-900/60 px-3 py-1 text-xs text-slate-200">{{.}}</span>
                                {{end}}
                            {{else}}
                                <span class="inline-flex items-center rounded-full border border-white/20 bg-slate-900/60 px-3 py-1 text-xs text-slate-200">Any pool allowed</span>
                            {{end}}
                        </div>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-3 text-center text-slate-200">
                        <div class="rounded-xl border border-white/10 bg-slate-900/60 p-3">
                            <p class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Max CPU</p>
                            <p class="text-xl font-semibold text-white">{{.Restrictions.MaxCPUCores}}</p>
                        </div>
                        <div class="rounded-xl border border-white/10 bg-slate-900/60 p-3">
                            <p class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Max RAM (MB)</p>
                            <p class="text-xl font-semibold text-white">{{.Restrictions.MaxMemoryMB}}</p>
                        </div>
                        <div class="rounded-xl border border-white/10 bg-slate-900/60 p-3">
                            <p class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Max disk (MB)</p>
                            <p class="text-xl font-semibold text-white">{{.Restrictions.MaxDiskMB}}</p>
                        </div>
                    </div>
                </div>
            </article>
            <article class="rounded-2xl border border-white/5 bg-slate-900/70 p-5">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Network resources</p>
                        <h3 class="text-lg font-semibold text-white">Competition subnet pool</h3>
                    </div>
                    <p class="text-xs text-slate-400">Pool · {{ .Network.PoolCIDR }}</p>
                </div>
                <p class="mt-3 text-xs text-slate-500">Blocks carved as /{{.Network.CompetitionPrefix}} networks. Team prefixes are /{{.Network.TeamPrefix}}.</p>
                <div class="mt-4 rounded-2xl border border-white/10 bg-slate-900/30 p-4">
                    <div class="flex items-center justify-between text-xs uppercase tracking-[0.3em] text-slate-500">
                        <span>Subnets used</span>
                        <span>{{ .Network.UsedSubnets }}/{{ .Network.TotalSubnets }}</span>
                    </div>
                    <div class="mt-3 h-2 w-full overflow-hidden rounded-full bg-white/10">
                        <div class="h-full bg-emerald-400" style='width: {{printf "%.1f" .Network.UsagePercent}}%'></div>
                    </div>
                    <div class="mt-2 flex items-center justify-between text-xs text-slate-400">
                        <span>{{ .Network.FreeSubnets }} free</span>
                        <span>{{printf "%.1f" .Network.UsagePercent}}% used</span>
                    </div>
                </div>
                <dl class="mt-4 grid gap-3 text-sm text-slate-200 sm:grid-cols-2">
                    <div class="rounded-xl border border-white/5 bg-slate-900/40 p-3">
                        <dt class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Gateway</dt>
                        <dd class="text-white">{{ .Network.Gateway }}</dd>
                    </div>
                    <div class="rounded-xl border border-white/5 bg-slate-900/40 p-3">
                        <dt class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Nameserver</dt>
                        <dd class="text-white">{{ .Network.Nameserver }}</dd>
                    </div>
                    <div class="rounded-xl border border-white/5 bg-slate-900/40 p-3">
                        <dt class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Search domain</dt>
                        <dd class="text-white">{{ .Network.SearchDomain }}</dd>
                    </div>
                    <div class="rounded-xl border border-white/5 bg-slate-900/40 p-3">
                        <dt class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Container CIDR</dt>
                        <dd class="text-white">/{{ .Network.ContainerCIDR }}</dd>
                    </div>
                </dl>
            </article>
        </div>
    </section>
    {{end}}

    <section class="rounded-3xl border border-white/10 bg-slate-900/60 p-4 sm:p-6">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4">
            <h2 class="text-xl font-semibold text-white">Competitions</h2>
            <button id="refresh-dashboard"
                class="self-start sm:self-auto text-xs uppercase tracking-[0.3em] text-white/70 hover:text-white">Refresh</button>
        </div>
        <div id="empty" class="hidden text-slate-400 text-sm py-6 text-center">No competitions yet.</div>
        <ul id="comps" class="space-y-4" data-can-manage="{{if .CanManage}}true{{else}}false{{end}}"></ul>
    </section>

</div>

{{if .CanManage}}
<div id="create-modal" class="hidden fixed inset-0 z-50">
    <div id="create-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
    <div class="relative z-10 min-h-screen w-full flex items-center justify-center p-4">
        <div class="w-full max-w-3xl rounded-3xl border border-white/10 bg-slate-900 shadow-2xl shadow-black/30 max-h-[90vh] flex flex-col overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/10 bg-slate-900 flex-shrink-0">
                <h3 class="text-lg font-semibold text-white">Create Competition</h3>
                <button id="close-create"
                    class="text-slate-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-blue-400 rounded">&times;</button>
            </div>
            <div class="p-6 space-y-6 text-slate-100 flex-1 overflow-y-auto min-h-0">
                <form id="create-comp" class="space-y-6" action="javascript:void(0);" enctype="multipart/form-data">
                    <div>
                        <label for="package-file" class="block text-sm font-medium text-slate-200">Competition package (.zip)</label>
                        <div id="package-dropzone"
                            class="mt-2 flex flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-white/20 bg-slate-800 px-4 py-8 text-center text-slate-300 transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3 15.75V18a2.25 2.25 0 002.25 2.25h13.5A2.25 2.25 0 0021 18V15.75m-9-9v9m0-9-3 3m3-3 3 3" />
                            </svg>
                            <div>
                                <p class="text-sm font-semibold text-white">Drop your <code>competition.zip</code> here</p>
                                <p class="text-xs text-slate-400">or</p>
                            </div>
                            <button type="button" id="package-browse"
                                class="rounded-full bg-blue-600/90 px-4 py-2 text-sm font-medium text-white hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-300">
                                Browse files
                            </button>
                            <input id="package-file" name="file" type="file" accept=".zip,application/zip,application/x-zip-compressed"
                                class="hidden" />
                        </div>
                        <p class="mt-2 text-sm text-slate-400">Follow the structure shown in the README when building your
                            competition archive.</p>
                    </div>
                    <div id="package-summary"
                        class="hidden rounded-2xl border border-white/10 bg-slate-900/80 p-4 text-sm text-slate-200 shadow-inner shadow-black/10">
                        <p class="flex items-center justify-between"><span class="font-medium">File</span><span
                                data-field="name">None selected</span></p>
                        <p class="flex items-center justify-between"><span class="font-medium">Size</span><span
                                data-field="size">0 B</span></p>
                        <p class="flex items-center justify-between"><span class="font-medium">Status</span><span
                                data-field="status" class="text-slate-300">Waiting for upload</span></p>
                    </div>
                    <div class="flex flex-col gap-2">
                        <div class="flex items-center gap-2 text-sm text-slate-300">
                            <input id="enable-advanced-logging" type="checkbox" class="h-4 w-4 rounded border-white/30 bg-slate-800/80 text-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <label for="enable-advanced-logging" class="select-none cursor-pointer">Enable advanced logging</label>
                        </div>
                        <div class="flex items-center justify-end gap-3">
                            <button id="cancel-create" type="button"
                                class="px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-blue-300">Cancel</button>
                            <button type="submit" id="upload-package"
                                class="px-4 py-2 rounded-lg bg-blue-500 text-white font-medium hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-200">Upload
                                package</button>
                        </div>
                    </div>
                </form>
                <pre id="create-log" class="hidden mt-4 p-3 bg-slate-950 text-emerald-200 rounded-lg border border-white/10 max-h-48 overflow-auto text-sm w-full"></pre>
            </div>
        </div>
    </div>
</div>
    <div id="redeploy-modal" class="hidden fixed inset-0 z-50">
        <div id="redeploy-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
        <div class="relative z-10 min-h-screen w-full flex items-center justify-center p-4">
            <div class="w-full max-w-2xl rounded-3xl border border-white/10 bg-slate-900 shadow-2xl shadow-black/30 overflow-hidden">
                <div class="flex items-start justify-between px-6 py-4 border-b border-white/10 bg-slate-900 rounded-t-3xl">
                    <div>
                        <p class="text-xs uppercase tracking-[0.3em] text-slate-500 mb-1">Redeploy container</p>
                        <p data-redeploy-target class="text-lg font-semibold text-white">Awaiting selection</p>
                    </div>
                    <button id="close-redeploy" aria-label="Close redeploy status"
                        class="text-slate-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-blue-400 rounded">&times;</button>
                </div>
                <div class="p-6 space-y-4 text-slate-200">
                    <p data-redeploy-status class="text-sm font-semibold text-slate-300">Waiting to start</p>
                    <pre id="redeploy-log" class="hidden mt-3 p-3 bg-slate-950 text-emerald-200 rounded-lg border border-white/10 max-h-48 overflow-auto text-sm w-full"></pre>
                    <div class="space-y-3">
                        <label class="inline-flex items-center gap-2 text-slate-300 text-sm">
                            <input type="checkbox" data-redeploy-start-checkbox class="h-4 w-4 rounded border-white/30 bg-slate-800/80 text-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <span>Start when finished</span>
                        </label>
                        <label class="inline-flex items-center gap-2 text-slate-300 text-sm">
                            <input type="checkbox" data-redeploy-advanced-logging class="h-4 w-4 rounded border-white/30 bg-slate-800/80 text-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <span>Show detailed logs</span>
                        </label>
                        <div class="flex justify-end">
                            <button type="button" data-redeploy-confirm data-default-label="Redeploy container"
                                class="inline-flex items-center rounded-2xl bg-blue-500 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-300">
                                Redeploy container
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="teardown-modal" class="hidden fixed inset-0 z-50">
        <div id="teardown-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
        <div class="relative z-10 min-h-screen w-full flex items-center justify-center p-4">
            <div class="w-full max-w-2xl rounded-3xl border border-white/10 bg-slate-900 shadow-2xl shadow-black/30 overflow-hidden">
                <div class="flex items-start justify-between px-6 py-4 border-b border-white/10 bg-slate-900 rounded-t-3xl">
                    <div>
                        <p class="text-xs uppercase tracking-[0.3em] text-slate-500 mb-1">Destroy competition</p>
                        <p data-teardown-target class="text-lg font-semibold text-white">Awaiting selection</p>
                    </div>
                    <button id="close-teardown" aria-label="Close teardown modal"
                        class="text-slate-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-blue-400 rounded">&times;</button>
                </div>
                <div class="p-6 space-y-4 text-slate-200">
                    <p data-teardown-status class="text-sm font-semibold text-slate-300">Awaiting confirmation</p>
                    <pre id="teardown-log" class="hidden mt-3 p-3 bg-slate-950 text-rose-200 rounded-lg border border-white/10 max-h-48 overflow-auto text-sm w-full"></pre>
                    <div class="space-y-3">
                        <p class="text-sm text-slate-300">Destroying this competition removes all containers, teams, and stored data. This cannot be undone.</p>
                        <div class="flex justify-end">
                            <button type="button" data-teardown-confirm data-default-label="Destroy competition"
                                class="inline-flex items-center rounded-2xl bg-rose-500 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white hover:bg-rose-400 focus:outline-none focus:ring-2 focus:ring-rose-300">
                                Destroy competition
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{{end}}

<script type="module" src="/static/dashboard.js" defer></script>
